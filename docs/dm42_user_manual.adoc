:stylesheet: https://tech.swissmicros.com/User-Manuals/usermanuals.css
:linkcss:
:table-stripes: even
:chapter-label: 
:allow-uri-read:
:doctype: book
:lang: en

:version: 3.26

:toc: left
:toclevels: 3
:sectnums:
:sectnumlevels: 3
:source-highlighter: coderay
:icons: font
:experimental:
:imagesdir: img/dm42_user_manual


// Our variables
:add-QSPI:
:add-OLDFW:
:platform: DM42
:pgmname:  DM42PGM
:webdir:   dm42

:title-page: DM42 User Manual
= DM42 User Manual
SwissMicros GmbH
Copyright © 2016 – {localyear} • v{version} • {docdate}


== About this User Manual

This user manual refers to special features of DM42.

Look at the following documentation for description of basic calculator functionality:

// - link:http://www.hp41.net/forum/fileshp41net/manuel-hp42s-us.pdf[HP-42S Owner's Manual]
// - link:http://www.hp41.net/forum/fileshp41net/hp42s-programming-examples.pdf[HP-42S Programming Examples and Techniques]

- link:https://literature.hpcalc.org/community/hp42s-om-en.pdf[HP-42S Owner's Manual]
- link:https://literature.hpcalc.org/community/hp42s-prog-en.pdf[HP-42S Programming Examples and Techniques]
- link:https://thomasokken.com/free42/42s.pdf[Free42 Manual]
- link:https://thomasokken.com/free42/#doc[Free42 Extensions]

SwissMicros calculators forum for discussion and help:

- link:https://forum.swissmicros.com/[]


{blank} +
====
_Many thanks to Godwin also known as grsbanks in link:https://forum.swissmicros.com/[SwissMicros Forum] for extensive contribution to DM42 project. Especially for his fearless testing, proofreading of this manual, fruitful ideas, forum moderation and top-notch release posts._
====



////

   ▄▄▄                                     ▀▀█           ▄▄▄▄▄           ▄▀▀
 ▄▀   ▀  ▄▄▄   ▄ ▄▄    ▄▄▄    ▄ ▄▄   ▄▄▄     █             █    ▄ ▄▄   ▄▄█▄▄   ▄▄▄
 █   ▄▄ █▀  █  █▀  █  █▀  █   █▀  ▀ ▀   █    █             █    █▀  █    █    █▀ ▀█
 █    █ █▀▀▀▀  █   █  █▀▀▀▀   █     ▄▀▀▀█    █             █    █   █    █    █   █
  ▀▄▄▄▀ ▀█▄▄▀  █   █  ▀█▄▄▀   █     ▀▄▄▀█    ▀▄▄         ▄▄█▄▄  █   █    █    ▀█▄█▀

////

== General Information


=== Specifications

[options="header",cols="1,3",width="80%"]
|=============================================
|Specification        | Details
| Construction        | Case made from stainless steel, matte black Physical Vapour Deposition (PVD) coated and laser engraved
| Software            | Open Source Free42 running on SwissMicros Operating System (DMCP)
| Floating point standard | IEEE 754-2008, 128-bit floating point precision implementation with 128-bit transcendental function support
| ISO conformity      | ISO/IEC TR 24732
| Processor           | Ultra low power ARM Cortex-M4F 80 MHz
| Flash memory        | 32 MBit external flash
| Display type        | Monochromatic ultra high contrast (14:1) transflective memory LCD display
| Display resolution  | 400 × 240 pixels
| Display active area | 58.8 mm × 35.28 mm
| Display dot pitch   | 147 µm × 147 µm
| Connectivity (PC)   | USB-Micro-B port, connects as USB mass storage device
| Connectivity (IR)   | IR Transmitter compatible with the original HP-82240A/B printer
| Battery type        | 1 × CR2032 lithium coin cell, 3.0 volts^[1]^
| Battery life        | Up to 3 years
| Sound               | 4 kHz resonance frequency Piezo-electric buzzer
| Size                | 77 mm × 144 mm × 12 mm
| Weight              | 180 g
| Warranty            | 5 years
|=============================================


NOTE: [1] The battery isn't rechargeable. See <<battery,Battery>> chapter below for
battery replacement and further info.




=== CPU Speed

CPU speed is 24MHz when running on battery (due to limited battery current) and increases to 80MHz when the USB cable is connected.


=== IR Printing

Calculator contains IR output and can print on HP 82240B infrared printer.


[[internal_fat_disk]]
=== Internal FAT disk

The calculator has 6MB of internal flash storage formatted as a FAT filesystem that is used for loading/saving programs and for backing up calculator state.
It is accessible as USB disk when activated via the menu 'File > Activate USB Disk >'.

[IMPORTANT]
====
Internal flash has limited amount of write cycles.
While the lifetime with ordinary usage could be dozens of years,
an excessive number of writes will wear the flash memory much quicker.

In the worst case scenario, you would have to replace the flash chip, which is worth less than $1.
If needed, SwissMicros will replace the chip at no cost, but shipping costs must be covered by the customer.

The datasheet mentions a minimum of 100,000 write cycles, which sounds like a lot,
but any change in the filesystem means overwriting at least part of the file allocation table, which is stored in a static location.
====

Calculator comes with pre-filled FAT disk contents. In case the contents of the FAT area is lost it could be always downloaded from the SwissMicros
https://technical.swissmicros.com/dm42/fat/[DM42 FAT files] page. There are the contents of individual directories accessible separately or the whole contents of FAT disk can be downloaded as single zip file https://technical.swissmicros.com/dm42/resources/DM42_FAT.zip[DM42_FAT.zip].

There are several directories with special names on the FAT disk:

////
----
HELP
OFFIMG
PROGRAMS
SCREENS
STATE
----
////


HELP:::
 Contains help file(s) for built-in DM42 help that can be activated from main system soft menu by pressing btn:[F1] key (leftmost in top row of keys).

OFFIMG:::
 Bitmap files from this directory are displayed when the calculator is turned off. See <<off_images,OFF Images>> chapter for more details.

PRINTS:::
 Printing to a file creates output files (both text and images) in this directory.

PROGRAMS:::
 Raw files with programs are loaded/saved from/to this directory.

SCREENS:::
 Screenshots of calculator LCD are saved into this directory. See <<lcd_screenshots,LCD Screenshots>> for more details.

STATE:::
 Calculator state files with extension `.f42` are stored in this directory. See chapters <<load_state,Load State>> or <<save_state,Save State>> how the load or save calculator state.


[[battery]]
=== Battery

The calculator uses a single CR-2032 Lithium 3V battery.
It is not rechargeable, therefore it has to be replaced when depleted.

WARNING: Please remember it is always wise to make calculator data
backup before battery replacement. Use USB power during data backup
if possible.

You can power calculator from USB during battery replacement.

To change the battery:

- remove the 2 screws on the upper rear of the case,
- remove the back,
- (optional) connect USB cable to prevent power loss
- extract the old battery by gently pushing it out of the holder from the bottom towards the top of the case;
- then insert the new battery with plus (+) side facing up (away from the board),
- slide all the way down to the bottom of the holder,
- then replace the back and screw-in the 2 original screws.



////

   ▄▄▄         ▀▀█                  ▄▄▄▄▄▄          ▄                           ▀
 ▄▀   ▀  ▄▄▄     █     ▄▄▄          █      ▄   ▄  ▄▄█▄▄   ▄▄▄   ▄ ▄▄    ▄▄▄   ▄▄▄     ▄▄▄   ▄ ▄▄    ▄▄▄
 █      ▀   █    █    █▀  ▀         █▄▄▄▄▄  █▄█     █    █▀  █  █▀  █  █   ▀    █    █▀ ▀█  █▀  █  █   ▀
 █      ▄▀▀▀█    █    █             █       ▄█▄     █    █▀▀▀▀  █   █   ▀▀▀▄    █    █   █  █   █   ▀▀▀▄
  ▀▄▄▄▀ ▀▄▄▀█    ▀▄▄  ▀█▄▄▀         █▄▄▄▄▄ ▄▀ ▀▄    ▀▄▄  ▀█▄▄▀  █   █  ▀▄▄▄▀  ▄▄█▄▄  ▀█▄█▀  █   █  ▀▄▄▄▀

////

== Calculator Extensions

=== Virtual variables


Managing some of the new features specific to the DM42 is something that spurred a lot of discussion. Initially we wanted to re-purpose some of the so-called "reserved" flags of the HP-42S but it soon became apparent that others had already done so in various patches for Free42, and we wanted to avoid trampling on anybody's toes with our own patches for Free42.

The next idea was to extend the number of flags available beyond 100 but obviously only have them accessible via indirect addressing as there was no question of patching Free42 to accept 3 digits in the various flag instructions. But then, how do we make integer values (and one real value) available to programs without assigning a whole block of flags that are going to be awkward to read?

After that we thought of using extended register numbers. They would either have to be assigned ridiculously high index numbers in order to avoid conflict if someone decided to go for a register array SIZE of 2000, or they would have to be assigned negative index numbers. We couldn't use negative indexes because the HP-42S and Free42 just take the absolute value of the index and use that to access the correct register and some programs might rely on that.

We settled on the concept of "Virtual Variables". These are variables that do not (and cannot, for that matter) exist in the DM42's variable table. Because of this, they are not listed in the variable menu when you press RCL or STO but there is a way to make them easy-ish to access, just read on...

There are six such virtual variables:

[[vv_devid]]
"DevID":::
  Device ID (read-only) -- RCL "DevID" returns the type of DM42 you're using. There are currently two hardware models only identified by value 0 (zero) is returned by the DM42 units that we have. Other types of unit that may be produced in future will have different DevID values.


[[vv_grmod]]
"GrMod":::
 Graphics Mode (read-write) -- RCL "GrMod" retrieves the current graphics mode and STO "GrMod" sets the graphics mode to the number present in the X register. Graphics modes currently supported are:

- 0 = standard HP-42S resolution 131x16
- 1 = reserved for future use and maps to 0 on the DM42
- 2 = DM42 full resolution 200x120
- 3 = DM42 full resolution 400x240


[[vv_resx_resy]]
"ResX" and "ResY":::
  X- and Y-resolution (read-only) -- RCL "ResX" or RCL "ResY" recalls the current X-resolution or Y-resolution respectively into the X stack register. The values that you will get are 131, 200 or 400 for RCL "ResX" and 16, 120 or 240 for RCL "ResY" depending on the current graphics mode (0, 2 or 3).


[[vv_vbat]]
"Vbat":::
 Battery voltage (read-only) -- If you're running off battery power then this will give you the voltage read at that precise moment in time. If you're running on USB power then this will give you the last battery voltage that was recorded before connecting the USB cable. Note that the value retrieved here can and almost always will be different to the voltage displayed in the status bar. The latter is cached and almost always retrieved when the DM42 is idle. The voltage read from "Vbat" is the voltage read while you are using the keyboard and/or running a program. This can be useful for pausing lengthy processing if the battery voltage drops below a threshold and allowing it to recover before resuming.


[[vv_reflcd]]
"RefLCD":::
The purpose of programs can vary significantly. There are programs like a stopwatch or games, where quick refreshing of the LCD is required. On the other end of the spectrum are pure computational programs, where no LCD output is required throughout program execution and where it is more beneficial to utilize all the CPU time for computation rather than wasting it on unnecessary LCD updates.
The "RefLCD" virtual variable was introduced specifically to address those different requirements. It is possible to disable LCD refreshing altogether or to enable the periodic refresh of individual portions of the LCD.


==== RefLCD in more detail

It is possible to disable LCD refreshing altogether or to enable the periodic refresh of individual portions of the LCD.
The value that you store in this variable is in fact a bitmask as per the table below. Items whose corresponding bit is cleared are not refreshed whereas those whose bit is set are refreshed with 200ms timeout after the LCD contents changes.

[width="70%",options="header",cols="^1,^1,10"]
|=======================================
|Bit | Value | Zone
| 0  |   1   | Main area (stack/graphics)
| 1  |   2   | Goose
| 2  |   4   | Annunciators
|=======================================


In order to prevent any part of the LCD from refreshing and thus maximize performance, store the value 0 (zero) in "RefLCD". Storing 1 in the variable means that the main area will be updated with 200ms timeout (stack or the graphics display if that is what is active). 2 will allow the goose to fly and 4 will allow the annunciators (including the flag tiles) to be updated. To have more than one zone refreshed during program execution, store the sum of the bit value(s) in "RefLCD" as follows:

[width="70%",options="header",cols="^1,^1,10"]
|=======================================
| Value | Binary |   Zone(s)
|  0    |  000   |  None (no refreshing occurs)
|  1    |  001   |  Main area
|  2    |  010   |  Goose
|  3    |  011   |  Main area and goose
|  4    |  100   |  Annunciators
|  5    |  101   |  Annunciators and main area
|  6    |  110   |  Annunciators and goose
|  7    |  111   |  Annunciators, goose and main area (everything)
|=======================================


You can, however, still refresh zones on an ad hoc basis even when they don't normally refresh by storing the negative value of the bitmask value in "RefLCD". For example, to update the annunciators programatically "now", store -4 to "RefLCD".


One exception to this is the message area in which VIEW and AVIEW show their results. This is never disabled and is repainted with 200ms delay(if needed) even if zero is stored in "RefLCD". If the redraw response isn't fast enough (e.g. for a stopwatch application, see below) then you can have the message area refreshed by program by storing the value -8 in "RefLCD". This program shows an example of how to use it:

[source]
----
00 { 49-Byte Prgm }
01▸LBL "STOPW"
02 TIME
03 →HR
04 STO 02
05 "RefLCD"
06 ASTO 03
07 CLX
08 STO IND 03 @ Disable refreshing
09 FIX 02
10▸LBL 00
11 TIME
12 →HR
13 RCL- 02
14 3600
15 ×
16 VIEW ST X
17 -8
18 STO IND 03 @ refresh the message area now
19 GTO 00
----




==== Accessing virtual variables

Attempting to STO a value in a read-only virtual variable has no effect, so it is not possible to create these variables in the variables table within Free42. Because of this it is a bit awkward to RCL and STO them directly. We recommend adding a reference to the virtual variables that you will need in your program in order to access the variables indirectly later on. Something like this:

[source]
----
"GrMod"
ASTO 10
"ResX"
ASTO 11
"ResY"
ASTO 12
----

Where needed you can then simply address the virtual variables this way:

[source]
----
3
STO IND 10
"Pixels on "
├"screen: "
RCL IND 11
RCLx IND 12
ARCL ST X
AVIEW
STOP
----


=== F-Buttons

The top row of keyboard consists of six unprinted buttons referenced as F-Buttons (F1-F6) or Soft-Menu Buttons.
When no calculator menu is in action those buttons have following functions:

F1:::
 Displays the Help. Note that the `/HELP/index.htm` file has to be present. The latest version can be downloaded from
 the http://technical.swissmicros.com/dm42/fat/HELP/[DM42 help page].

F2:::
 Toggle this system soft menu visibility.

F3:::
 (not assigned)

F4:::
 Increase buzzer volume

SHIFT-F4:::
 Decrease buzzer volume

F5:::
 Toggle stack alignment (Left, Right, Right Underlined)

SHIFT-F5:::
 Toggle between sans and HP font

F6:::
 Increase font size

SHIFT-F6:::
 Decrease font size



[[flag_indicators]]
=== Flag State Indicators

There is special 'Flags area' which indicates state of calculator flags 0-10.

image::lcd_flags2.png[Flag Indicators]




=== PIXEL and AGRAPH

PIXEL and AGRAPH are not limited to the original HP-42S's resolution of 131x16 pixels. The compatibility with negative values to display lines and with complex numbers and matrices is conserved. You can now use horizontal values of 1≤X≤200 and vertical values of 1≤Y≤120 in 200x120 mode, or 1≤X≤400 and 1≤Y≤240 in 400x240 mode. Switching between 131x16, 200x120 and 400x240 modes is achieved using the
<<vv_grmod,*GrMod* virtual variable>> and current graphics resolution could be probed by
<<vv_resx_resy, *ResX* and *ResY*>>.




=== Alpha Input Mode

Upon entering Alpha input mode you will see a new annunciator on the screen:

- "[ ]" denotes original HP-42S input mode. This is the mode that Alpha input starts with when entered for the first time.
- "[a]" denotes lower case DM42 input mode.
- "[A]" denotes upper case DM42 input mode.

btn:[SHIFT] followed by btn:[▲] and btn:[▼] allow you to cycle through the modes.

The DM42 remembers which mode you were in last time alpha input was active and upon entering alpha input modes switches immediately to that mode.


Original HP-42S mode:::

- Function keys work as expected for standard characters.
- ASTO (STO) and ARCL (RCL) work as expected.
- "%", "pi" and "E" work as expected.
- btn:[SHIFT] btn:[SHOW] works as expected.
- Local labels LBL 01, LBL A and LBL a work as expected.
- Global labels LBL "ABC", LBL "123" and LBL "A123" work as expected.
- Un-shifted [R/S] works as expected and [SHIFT] [R/S] enters/leaves Prgm mode as expected.

Lower and upper case DM42 modes:::
- The function keys still allow input in HP-42S mode.
- All alpha keys A-Z give the expected characters.
- btn:[SHIFT] btn:[A] to btn:[SHIFT] btn:[O] give the same characters.
- btn:[SHIFT] btn:[0] (zero) to btn:[SHIFT] btn:[9] give the digits 0-9 instead of the alpha characters.
- Shifted btn:[÷], btn:[×], btn:[-] and btn:[\+] give '÷', '×', '-' and '+' instead of the alpha characters.
- Shifted btn:[R/S] gives '?' instead of entering/leaving Prgm mode.
- ASTO, ARCL, '%', 'pi' and 'E' (exponent) are not available. Switch to standard HP-42S mode to get them.
- btn:[SHIFT] btn:[SHOW] is not available. Use standard HP-42S mode.
- Two-digit local labels LBL 01 are not available. Use standard HP-42S mode.
- Local labels LBL A and LBL a and global labels LBL "ABC", LBL "123" and LBL "A123" work as expected.
- Un-shifted btn:[R/S] still behaves as usual allowing program execution to resume after inputting alpha data to a program.
- Function arguments (eg. STO* "h") work as expected


SST/BST in alpha input mode:::
Press and hold the btn:[SHIFT] key while pressing btn:[▲] or btn:[▼] in order to execute BST or SST respectively when in alpha input mode. As on the original HP-42S, BST will start auto-repeating after a while and SST will NULL after a couple of seconds if you press and hold btn:[▲] or btn:[▼] respectively.





[[print_to_file]]
=== Printing to File

Since DM42 3.10 in addition to default IR printing user can choose printing to file.

This functionality can be activated in <<print_to_file_menu,Printing menu>>.

Two output formats are supported:

Graphics Print::
Creates bitmap (`.bmp`) file with printed data in graphics.

Text Print::
Creates text (`.txt`) file with printed data in UTF-8.


The output file `/PRINTS/<time-stamp>.txt` for text output
and `/PRINTS/<times-tamp>.bmp` for graphics output
is created just after the 'Text Print' or 'Graphics Print' (respectively)
is activated in menu.

Disabling one of those options flushes appropriate buffer and finishes the file.
Next activation of previously deactivated 'Text Print' or 'Graphics Print'
creates new file with current time-stamp.

NOTE: Printing buffers are allocated from available calculator memory just after the
 'Text Print' or 'Graphics Print' is selected in menu. Error is displayed if
  not enough memory is available also no file is created and selected option isn't activated.


There are two options for tweaking the _print to file_ functionality:

Don't print to IR:: (affects both 'Text Print' and 'Graphics Print') +
  Disables printing to IR and printing delays.

Graphics in Text:: (affects 'Text Print' only) +
  If enabled graphics prints appear
  as block graphics in text file using Unicode "Block Elements". Note that you
  need reasonably equipped font to display the graphics print correctly (which
  isn't the default case for Windows users).




include::common_extensions.adoc[]



////

 ▄▄▄▄                            █                     ▄ ▄▄▄▄▄▄                          █
 █   ▀▄  ▄▄▄    ▄▄▄    ▄▄▄    ▄▄▄█   ▄▄▄    ▄ ▄▄      █  █      ▄ ▄▄    ▄▄▄    ▄▄▄    ▄▄▄█   ▄▄▄    ▄ ▄▄
 █    █ █▀  █  █▀  ▀  █▀ ▀█  █▀ ▀█  █▀  █   █▀  ▀    █   █▄▄▄▄▄ █▀  █  █▀  ▀  █▀ ▀█  █▀ ▀█  █▀  █   █▀  ▀
 █    █ █▀▀▀▀  █      █   █  █   █  █▀▀▀▀   █       █    █      █   █  █      █   █  █   █  █▀▀▀▀   █
 █▄▄▄▀  ▀█▄▄▀  ▀█▄▄▀  ▀█▄█▀  ▀█▄██  ▀█▄▄▀   █      █     █▄▄▄▄▄ █   █  ▀█▄▄▀  ▀█▄█▀  ▀█▄██  ▀█▄▄▀   █

////


== Program Decoder/Encoder

Thanks to generous contribution of Godwin (known as grsbanks in https://forum.swissmicros.com/[forum])
we can use web based program decoder and encoder for Free42 raw files - i.e. those files used for
program import/export in DM42.

Thus you can prepare your DM42 program directly on PC and then download it to DM42 and import it there.
As well as export programs written directly on DM42 and edit them on PC.

The program decoder/encoder is located at https://technical.swissmicros.com/dm42/decoder/. Follow this link
and look into *instructions* tab for more details.








////

 ▄▄▄▄   ▄    ▄    ▄▄   ▄▄▄▄         ▄    ▄
 █   ▀▄ ██  ██   ▄▀█  ▀    █        ██  ██  ▄▄▄   ▄ ▄▄   ▄   ▄   ▄▄▄
 █    █ █ ██ █  █▀ █      ▄▀        █ ██ █ █   █  █▀  █  █   █  █   ▀
 █    █ █ ▀▀ █ █▄▄▄█▄   ▄▀          █ ▀▀ █ █▀▀▀▀  █   █  █   █   ▀▀▀▄
 █▄▄▄▀  █    █     █  ▄█▄▄▄▄        █    █ ▀▄▄▄▀  █   █  ▀▄▄▀█  ▀▄▄▄▀

////


== DM42 Menus

Menu navigation:

- Select menu items using btn:[▲], btn:[▼] keys.
- Activate current menu item by pressing btn:[ENTER] key or by pressing the number key corresponding to particular menu line.
- Return to previous menu level by btn:[EXIT] or btn:[<-] key.



[[main_setup_menu]]
=== Main Setup menu

Main 'Setup menu' could be entered by pressing btn:[SHIFT]+btn:[SETUP].

From there other sub-menus could be entered or about screen displayed

1. <<file_menu,File menu>>
2. <<calculator_state_menu,Calc. State menu>>
3. <<print_to_file_menu,Printing>>
4. <<settings_menu,Settings menu>>
5. <<system_menu, System menu>>
6. About > Displays About screen.




[[file_menu]]
=== File menu

==== Load Program >
Used for loading the `.raw` programs stored in the `/PROGRAMS/` directory of the flash storage.

It should display all `.raw` files from `/PROGRAMS/` directory in alphabetical order.

To load program

- Select the program to load using the btn:[▲] and btn:[▼] keys
- btn:[ENTER] to load the selected program

Loading info flashes for a second until the program is loaded into calculator memory.

Then the program list is displayed again. You can load next program or leave the menu by btn:[EXIT] key.


==== Save Program >
Used for saving one or more program(s) from the calculator memory to a `.raw` file in the `/PROGRAMS/` directory of the flash storage.

- Select the program or programs to save, confirm with btn:[ENTER]
- Choose existing filename as target or type new target filename, confirm with btn:[ENTER]


==== Activate USB Disk >

Used to copy files from/to a host computer - e.g. backup/restore the calculator state files from `/STATE/` directory or read/write programs in RAW format into `/PROGRAMS/` directory.

- Connect the calculator to a computer using a USB cable
- The DM42's flash disk should be visible on the computer
- Read/write files
- 'Eject device' on the host machine.
- Calculator should end USB disk mode automatically if correctly ejected by OS. You can end USB disk mode by pressing btn:[EXIT] key on the calculator but be sure all data are flushed to disk first.

WARNING: The last two points 'Eject device' and 'Press btn:[EXIT] key on calculator' (if it doesn't end automatically) are important to avoid unsaved data and possible FAT disk corruption!



==== Show Disk Info >

Displays disk status and disk block info.






[[calculator_state_menu]]
=== Calculator State menu


The calculator reads last used state file after a hardware RESET (i.e. after pressing the [RESET] on the back of the calculator).

Reading of last stored calculator state file can be bypassed (eg. when the FAT disk is corrupted and the calculator hangs after a reset while reading the state file) by holding the btn:[-] key and pressing the [RESET] button on the back of the calculator.


[[load_state]]
==== Load State

Displays list of available calculator state files (`.f42` extension) from `/STATE/` directory.

To load calculator state file:

- Select particular file and press btn:[ENTER] to load the state file.

- Confirmation dialog appears and you have to acknowledge you want to abandon current calculator state.

If confirmed, calculator is restarted and selected calculator state file loaded.





[[save_state]]
==== Save State

Used for saving current calculator state to a `.f42` file into the `/STATE/` directory of the flash storage.

To save state file:
- Select existing filename as target or type new target filename, confirm with btn:[ENTER]
- Confirmation dialog can appear if existing file is about to be overwritten

If confirmed, calculator state is saved and subsequently is the calculator restarted and the calculator state file reloaded.



==== Load Clean State

Restarts the calculator without reading the state file (same as [RESET] + btn:[-]).



[[print_to_file_menu]]
=== Printing menu

For functional details look at <<print_to_file,Printing to File>>.

==== Graphics Print

Selecting this menu item enables printing to graphics file.


==== Text Print

Selecting this menu item  enables printing to text file.


==== Graphics in Text

Selecting this menu item enables to see graphics in text file.


==== Don't print to IR

Selecting this menu item disables default printing to IR printer.

==== Double Newline

Place one more newline after each printed line. This option applies only for printing to IR printer.


[[settings_menu]]
=== Settings menu

[[set_time]]
==== Set Time >

Used for setting the time.

- Use the function keys to adjust the time.
- Press btn:[ENTER] to write the new time to the calculator clock or btn:[EXIT] to cancel your changes.


[[set_date]]
==== Set Date >

Used for setting the date.

- Use the function keys to adjust the date.
- Press btn:[ENTER] to write the new date to the calculator clock or btn:[EXIT] to cancel your changes.
-  btn:[Σ+] could be used to change between DMY/MDY formats.


==== Status Bar >

Displays filed selector for what should be displayed in calculator top status bar:

----
Status Bar menu
1. State Filename
2. Day of Week
3. Date
4. Date Separator
5. Month Shortcut
6. Time
7. Power Voltage in Header
----

Fields are always displayed in order how they appear in this menu.


==== Stack Font Sizes >

Enters font size configuration for stack registers:

----
Stack Font Sizes menu
1. Font Size Offset Reg X: 0
2. Font Size Offset Reg Y: 0
3. Font Size Offset Reg Z: 0
4. Font Size Offset Reg T: 0
5. Font Size Offset Reg L: 0
6. Font Size Offset Reg A: 0
----

For each register a font offset in range -5 .. 5 could be specified.
Each font offset is relative to current font size set by btn:[F6] / btn:[SHIFT]+btn:[F6] keys.

*Example:* +
Lets expect there are five font sizes 1 to 5 and third font size is selected.
If the "Font Size Offset Reg X" is set to 1 and other offsets remain zeroed,
then the X register will be displayed in one step larger font then others.

Note that the if the maximal font size is reached the font remains at maximal size.
So, setting all font offsets to 5 actually disables any effect of btn:[F6] / btn:[SHIFT]+btn:[F6] keys.


==== Beep Mute

Selecting this menu item toggles the 'Beep Mute' flag.

When the 'Beep Mute' flag is active, no sounds are produced by the calculator.

Note that this value is stored in the calculator state file.



==== Slow Auto-repeat

Selecting this menu item toggles the 'Slow Auto-repeat' flag.

When the 'Slow Auto-repeat' flag is active auto-repeat delays are prolonged.

Note that this value is stored in the calculator state file.


==== Stack Layout

Enters stack layout selector where one of following layouts could be selected

----
Stack Layout menu
1. XYZTL
2. XYZTA
3. XYZT
4. XYL
5. XYA
6. XY
----


==== Dynamic Stack Extension

Selecting this menu item enables or disables the 'Big Stack' extension of Free42.





include::system_menu.adoc[]










////

 ▄▄▄▄▄▄   ▀                                                     ▄    ▄            █           ▄
 █      ▄▄▄     ▄ ▄▄  ▄▄▄▄▄ ▄     ▄  ▄▄▄    ▄ ▄▄   ▄▄▄          █    █ ▄▄▄▄    ▄▄▄█   ▄▄▄   ▄▄█▄▄   ▄▄▄
 █▄▄▄▄▄   █     █▀  ▀ █ █ █ ▀▄ ▄ ▄▀ ▀   █   █▀  ▀ █▀  █         █    █ █▀ ▀█  █▀ ▀█  ▀   █    █    █▀  █
 █        █     █     █ █ █  █▄█▄█  ▄▀▀▀█   █     █▀▀▀▀         █    █ █   █  █   █  ▄▀▀▀█    █    █▀▀▀▀
 █      ▄▄█▄▄   █     █ █ █   █ █   ▀▄▄▀█   █     ▀█▄▄▀         ▀▄▄▄▄▀ ██▄█▀  ▀█▄██  ▀▄▄▀█    ▀▄▄  ▀█▄▄▀
                                                                       █
                                                                       ▀
////

include::firmware_update.adoc[]






////

  ▄▄▄▄   ▄▄▄▄  ▄▄▄▄▄  ▄▄▄▄▄           ▄▀▀  ▀▀█                  █        ▀
 ▄▀  ▀▄ █▀   ▀ █   ▀█   █           ▄▄█▄▄    █     ▄▄▄    ▄▄▄   █ ▄▄   ▄▄▄    ▄ ▄▄    ▄▄▄▄
 █    █ ▀█▄▄▄  █▄▄▄█▀   █             █      █    ▀   █  █   ▀  █▀  █    █    █▀  █  █▀ ▀█
 █    █     ▀█ █        █             █      █    ▄▀▀▀█   ▀▀▀▄  █   █    █    █   █  █   █
  █▄▄█▀ ▀▄▄▄█▀ █      ▄▄█▄▄           █      ▀▄▄  ▀▄▄▀█  ▀▄▄▄▀  █   █  ▄▄█▄▄  █   █  ▀█▄▀█
     █                                                                                ▄  █
                                                                                       ▀▀
////

=== QSPI flashing

WARNING: No action related to QSPI contents is needed until firmware requests QSPI update by showing <<dmcp_sys_menu,DMCP System menu>>
or <<qspi_load_menu,"QSPI Load" menu>> for versions before 3.7.

TIP: Latest QSPI flash contents could be found at https://technical.swissmicros.com/dm42/firmware/qspi_data/.

*If you are looking for quick QSPI update instructions you most probably want to follow <<flash_qspi_from_fat,Flashing QSPI from FAT disk>> instructions.*



==== General information

While the contents of main flash changes with each firmware version. The QSPI contents is usually preserved and it will be explicitly noted in release notes when the QSPI contents changes.

Moreover, DMCP system makes checksum of expected QSPI contents after RESET before launching loaded program. If this check fails the DMCP system doesn't allow to start the program and writes information about missing QSPI data. Then you can use
<<dmcp_sys_menu,DMCP System Menu>> for both copying the QSPI data file to calculator as well to install this file.


*Obsolete:* Firware versions from 2.10.13 to 3.7 contain built-in <<qspi_load_menu,QSPI loader>> which is activated when QSPI data doesn't match.


The prefered option for QSPI update is to use "QSPI Load" menu to copy firmware to the calculator filesystem and
<<flash_qspi_from_fat,flash the QSPI contents from the file>>.

User can also switch the calculator <<bootloader_mode_activation, into bootloader mode>> and then use `dfu-util` or `dm_tool` (obsolete) described below.




[[flash_qspi_from_fat]]
==== Flashing QSPI from FAT disk

Here we will update QSPI flash contents. We expect here calculator in <<dmcp_sys_menu,DMCP menu>>.
Which is the place where calculator stops if you need to update QSPI flash contents.


Prerequisites::
`DM42_qspi_x.x.bin` - QSPI data file, e.g. `DM42_qspi_3.x.bin` +

*Steps*

. We expect the calculator in <<dmcp_sys_menu,DMCP menu>>.
. Activate USB disk from DMCP menu "Activate USB Disk"
. Connect USB cable from DM42 to PC/Mac computer.
. Copy the `DMCP_flash_x.x.bin` file from the PC/Mac computer to root folder of calculator disk.
. Eject (safely remove) the calculator disk from PC/Mac computer. *Please, be patient this can
  take some time. Don't unplug USB cable until safely ejected from OS.*
. Start QSPI update from DMCP menu "Load QSPI from FAT"
. After successful updating the QSPI data file is removed from calculator disk




==== Flashing QSPI using dm_tool (obsolete)

Note that this method is obsolete and will be removed.

The `dm_tool` takes care about QSPI loader itself. Thus flashing new QSPI contents is as easy as flashing QSPI and ordinary flash contents in a row:

. Flash `DM42_qspi_xxx.bin`
. Flash `DM42_flash_xxx.bin`

The second step is important as the ordinary firmware is replaced by QSPI loader in first step.

See <<launching_dm_tool, Launching dm_tool>> for details about flashing using `dm_tool`.



==== Flashing QSPI using dfu-util

Download QSPI loader firmware `DMflash.bin`::
Get `DMflash.bin` from the URL http://technical.swissmicros.com/tools/DMflash-2.3.bin.

Switch the calculator into bootloader mode::
From menu or by RESET+PGM buttons (see <<bootloader_mode_activation, Bootloader mode activation>>).

Flash QSPI bootloader::
{blank}
+
--

----
dfu-util -D DMflash.bin -a "@Internal Flash  /0x08000000/512*0002Kg" -s 0x8000000
----

Press RESET button after `dfu-util` finishes the flashing.
--

Flash QSPI contents::
{blank}
+
--

----
dfu-util -D DM42_qspi_2.10.12.bin -a "@QSPI Flash   /0x90000000/512*04Kg" -s 0x90000000
----

Press btn:[F6] (top right key) to switch the calculator back to bootloader mode.
--

Flash main firmware::
{blank}
+
--

----
dfu-util -D DM42_flash_2.10.12.bin -a "@Internal Flash  /0x08000000/512*0002Kg" -s 0x8000000
----

Press RESET button after `dfu-util` finishes the flashing.

Note that this step is important as the ordinary firmware is replaced by QSPI loader earlier.
--





////
 ▄▄▄▄   ▄    ▄   ▄▄▄  ▄▄▄▄▄          ▄▄▄▄                  ▄                         ▄    ▄
 █   ▀▄ ██  ██ ▄▀   ▀ █   ▀█        █▀   ▀ ▄   ▄   ▄▄▄   ▄▄█▄▄   ▄▄▄   ▄▄▄▄▄         ██  ██  ▄▄▄   ▄ ▄▄   ▄   ▄
 █    █ █ ██ █ █      █▄▄▄█▀        ▀█▄▄▄  ▀▄ ▄▀  █   ▀    █    █▀  █  █ █ █         █ ██ █ █▀  █  █▀  █  █   █
 █    █ █ ▀▀ █ █      █                 ▀█  █▄█    ▀▀▀▄    █    █▀▀▀▀  █ █ █         █ ▀▀ █ █▀▀▀▀  █   █  █   █
 █▄▄▄▀  █    █  ▀▄▄▄▀ █             ▀▄▄▄█▀  ▀█    ▀▄▄▄▀    ▀▄▄  ▀█▄▄▀  █ █ █         █    █ ▀█▄▄▀  █   █  ▀▄▄▀█
                                            ▄▀
                                           ▀▀
////

include::dmcp_system_menu.adoc[]




////

  ▄▄▄▄   ▄▄▄▄  ▄▄▄▄▄  ▄▄▄▄▄         ▄                        █
 ▄▀  ▀▄ █▀   ▀ █   ▀█   █           █       ▄▄▄    ▄▄▄    ▄▄▄█         ▄▄▄▄▄   ▄▄▄   ▄ ▄▄   ▄   ▄
 █    █ ▀█▄▄▄  █▄▄▄█▀   █           █      █▀ ▀█  ▀   █  █▀ ▀█         █ █ █  █▀  █  █▀  █  █   █
 █    █     ▀█ █        █           █      █   █  ▄▀▀▀█  █   █         █ █ █  █▀▀▀▀  █   █  █   █
  █▄▄█▀ ▀▄▄▄█▀ █      ▄▄█▄▄         █▄▄▄▄▄ ▀█▄█▀  ▀▄▄▀█  ▀█▄██         █ █ █  ▀█▄▄▀  █   █  ▀▄▄▀█
     █

////

[[qspi_load_menu]]
=== QSPI Load menu

NOTE: Obsolete, valid for versions before 3.7


This menu is displayed only when the calculator detects invalid contents of QSPI firmware area.


image::qspi_load_menu.png[QSPI Load menu]



==== Bootloader

Activates bootloader mode for firmware flashing.

Press the RESET button on the back of the calculator if you activate Bootloader mode accidentally.


==== Load QSPI from FAT

Starts flashing of the QSPI firmware. The firmware `DM42_qspi_xxx.bin` is expected to be stored
in the FAT filesystem root directory.


==== Activate USB Disk >

Used to copy files from/to a host computer.

- Connect the calculator to a computer using a USB cable
- The DM42's flash disk should be visible on the computer
- Read/write files
- 'Eject device' on the host machine.
- Calculator should end USB disk mode automatically if correctly ejected by OS. You can end USB disk mode by pressing btn:[EXIT] key on the calculator but be sure all data are flushed to disk first.

WARNING: The last two points 'Eject device' and 'Press btn:[EXIT] key on calculator' (if it doesn't end automatically) are important to avoid unsaved data and possible FAT disk corruption!


==== Format FAT Disk >

Format the internal FAT disk storage. All data is erased.


==== FAT Disk Media Test >

Checks whole flash disk FAT area for bad blocks. Disk is formatted starting from first good block after the check.

WARNING: All data is erased from disk.


==== Show Disk Info >

Displays disk status and disk block info.

image::http://tech.swissmicros.com/visual_assets/drw_dm42_front_150.png["DM42"]




